{% extends 'base.html.twig' %}

{% block title %}Inscription{% endblock %}

{% block body %}
    <div class="container-registration mt-5 pt-5">
        <h1 class="display-4">Inscription</h1>
        {{ form_start(registrationForm, {'attr': {'class': 'form-horizontal', 'novalidate': 'novalidate'}}) }}
            <div class="form-group row mb-3">
                {{ form_label(registrationForm.prenom, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.prenom, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.prenom) }}
                    </div>
                </div>
            </div>
            <div class="form-group row mb-3">
                {{ form_label(registrationForm.nom, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.nom, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.nom) }}
                    </div>
                </div>
            </div>
            <div class="form-group row mb-3">
                {{ form_label(registrationForm.email, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.email, {'attr': {'class': 'form-control', 'type': 'email'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.email) }}
                    </div>
                </div>
            </div>
            <div class="form-group row mb-3">
                {{ form_label(registrationForm.password, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.password, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.password) }}
                    </div>
                </div>
            </div>
            <div class="form-group row mb-3">
                {{ form_label(registrationForm.typeClient, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.typeClient, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.typeClient) }}
                    </div>
                </div>
            </div>
            <div class="form-group row siret-field mb-3" style="display: none;">
                {{ form_label(registrationForm.siret, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.siret, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.siret) }}
                    </div>
                </div>
            </div>
            <div class="form-group row entreprise-field mb-3" style="display: none;">
                {{ form_label(registrationForm.entreprise, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.entreprise, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.entreprise) }}
                    </div>
                </div>
            </div>
            <div class="form-group row mb-3">
                {{ form_label(registrationForm.rue, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.rue, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.rue) }}
                    </div>
                </div>
            </div>
            <div class="form-group row mb-3">
                {{ form_label(registrationForm.ville, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.ville, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.ville) }}
                    </div>
                </div>
            </div>
            <div class="form-group row mb-3">
                {{ form_label(registrationForm.codePostal, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.codePostal, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.codePostal) }}
                    </div>
                </div>
            </div>
            <div class="form-group row mb-3">
                {{ form_label(registrationForm.pays, null, {'label_attr': {'class': 'col-sm-2 col-form-label'}}) }}
                <div class="col-sm-5">
                    {{ form_widget(registrationForm.pays, {'attr': {'class': 'form-control'}}) }}
                    <div class="form-error">
                        {{ form_errors(registrationForm.pays) }}
                    </div>
                </div>
            </div>
            <div class="form-group row mb-3">
                <div class="col-sm-5 offset-sm-2">
                    {{ form_widget(registrationForm.save, {'attr': {'class': 'btn btn-primary btn-lg'}}) }}
                </div>
            </div>
        {{ form_end(registrationForm) }}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const form = document.querySelector('form');
        const typeClientRadios = document.querySelectorAll('input[name="client[typeClient]"]');
        const siretField = document.querySelector('.siret-field');
        const entrepriseField = document.querySelector('.entreprise-field');

        function toggleFields() {
            const typeClient = document.querySelector('input[name="client[typeClient]"]:checked');
            if (typeClient && typeClient.value === 'professionnel') {
                siretField.style.display = 'flex';
                entrepriseField.style.display = 'flex';
            } else {
                siretField.style.display = 'none';
                entrepriseField.style.display = 'none';
            }
        }

        typeClientRadios.forEach(radio => {
            radio.addEventListener('change', toggleFields);
        });

        toggleFields(); // Initial call to set the correct state on load

        form.addEventListener('submit', function(event) {
            // Remove previous error messages
            const errorElements = document.querySelectorAll('.form-error');
            errorElements.forEach(el => el.innerText = '');

            let isValid = true;

            // Check email field
            const emailField = form.querySelector('input[type="email"]');
            if (emailField && !emailField.validity.valid) {
                isValid = false;
                const errorElement = emailField.closest('.form-group').querySelector('.form-error');
                if (emailField.validity.valueMissing) {
                    errorElement.innerText = "L'email ne peut pas Ãªtre vide.";
                } else if (emailField.validity.typeMismatch) {
                    errorElement.innerText = "L'adresse email n'est pas valide.";
                }
            }

            // Add other custom validations as needed

            if (!isValid) {
                event.preventDefault();
                event.stopPropagation();
            }

            form.classList.add('was-validated');
        }, false);
    });
    </script>
{% endblock %}






















